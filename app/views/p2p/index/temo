

<script id='product_template' type='text/template'>
    
  <div class="product">
    <a href="/p2p/view/<%%= elm.id  %> ">

      <div class="product_img">
       <img src="<%%= elm.image %>" alt="Picture coming Soon...."  width="100px" height="50px" />
      </div>
   
      <div class="product_title">
        <em>  <%%=elm.title %>  </em> <br/>
      </div>
      
      
      <div class="product_tag">
      <em><del>&#2352;</del> <%%= elm.price %></em> 
      </div>
     </a>
  </div>
 
</script>


<script type="text/javascript">



$("#search_books_input").keyup(function(){
    console.log($.trim($("#search_books_input").val()).length + "len");

      if ($.trim($("#search_books_input").val()).length <=1){
        $("#content").show();
        $("#search_result").hide();
        return;
    }

});
function search(){ 
      $("#search_books_input").removeClass("error");
      

    if ($.trim($("#search_books_input").val()).length <=1){
        $("#content").show();
        $("#search_result").hide();
        return;
    }

    $.ajax({
        url: '/p2p/search/' + $("#search_books_input").val(),
        type: 'GET',
        dataType:"json",

        success: function(data) {
            console.log(data);

            if (data.length == 0 ){
                $("#content").show();
                $("#search_result").hide();
                $("#search_books_input").addClass("error");
                return;
            }

            template=$("#product_template").html();

            $("#search_result").html("");


            if(data['type'] == 'cat'){

                  var temp = [];

                _.each(data["data"],function(elm){

                      temp.push("<h3>Results in " + elm.cat + "(" + elm["items"].length +")</h3>" );

                        console.log(elm);
                        
                      _.each(elm["items"],function(item){ 
                          temp.push( _.template(template,{elm:item}) );
                      });

                      temp.push("<div class='clearfix'></div>");
                  });

                  

                  $("#search_result").append(temp.join("    "));

            }



            if(data['type'] == 'pro'){

                  var temp = [];

                _.each(data["data"],function(elm){

                      temp.push("<h3>Results in " + elm.cat + "(" + elm["items"].length +")</h3>" );

                        console.log(elm);
                        
                      _.each(elm["items"],function(item){ 
                          temp.push( _.template(template,{elm:item}) );
                      });

                      temp.push("<div class='clearfix'></div>");
                  });

                  

                  $("#search_result").append(temp.join("    "));

            }

            if (data['type'] == 'item'){

            
            _.each(data["data"],function(elm){$("#search_result").append( "<h3>Other Results(" + data["data"].length +")</h3>" + _.template(template,{elm:elm}) + "<div class='clearfix'></div>");});

            }
            $("#search_result").show();
            $("#content").hide();




       }

  });
}


</script>


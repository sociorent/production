<%= stylesheet_link_tag "get_user_details" %>
<div id="loading_div">Loading ... Please wait</div>
<div id="content">
	<form id="form">
	  <legend>Give us a few more details</legend>
	  <p><input type="text" placeholder="Mobile Number" name="mobile" id="mobile"></p>
	  <p>
	  	<select id="college"><option value="">Enter College Name</option>
	  		<% @college_names.each do |name| %>
	  			<option value="<%= name %>"><%= name %></option>
	  		<% end %>
	  	</select>
	  	<select id="streams"><option value="">Enter Stream</option>
	  		<% @streams.each do |name| %>
	  			<option value="<%= name %>"><%= name %></option>
	  		<% end %>
	  	</select>
	  </p>
	  <p class='reg_submit'><button type="submit" class="btn">Submit</button></p>
	</form>
	<div id="error"></div>
</div>
<script type="text/javascript">
	$(document).ready(function(){

		$("#college").chosen();

		$("#streams").chosen();

		$("#form").submit(function(){
			mobile = $.trim($("#mobile").val());
			college = $("#college").val();
			stream = $("#streams").val();
			if(!college)
				$("#error").html("Please select your college.");
			else if(!stream)
				$("#error").html("Please select your stream.");
			else if($("#form").valid()){			
				$("#loading_div").fadeIn();
				$.ajax("/users/save_user_details", {
					type:"post",
					async:true,
					data: {
						mobile: mobile,
						college: college,
						stream: stream,
					},
					success: function(msg){
						if(msg == "1")
							window.location.href = "/"
						$("#loading_div").fadeOut();
					},
				});

			}
			return false;
		});
		$("#form").validate({
		  rules: {
		    mobile: {
		      required: true,
		      digits: true,
		      minlength: 10,
		      maxlength: 11,
		      remote :"/validate/mobile"
		    }
		  },
		  highlight: function(label) {
		    return $(label).closest(".control-group").addClass("error");
		  }
		});
	});
</script>